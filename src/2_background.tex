\chapter{背景}
\label{background}

本章では本研究の背景について述べる．

\section{地理的分散システム}
\label{background:geographically-disdtributed-system}
本節では，地理的分散システムの具体例ついて概説する．

\subsection{Winny}
Winnyはソフトウェアエンジニア金子勇氏が開発し、2002年に発表されたファイル共有ソフトである。
システム上で中央集権的なサーバを保持せず、ノード同士が相互に接続することで実現されるP2Pアプリケーションとして注目を浴びた。
ユーザはノード内に保持されたファイルを他のノードと共有することができるため、任意のファイルをアップロードしたり、逆に他のノードが保持しているファイルをダウンロードすることができる。
Winnyでは、受信ファイルの送信元や送信ファイルの宛先をユーザが確認することはできず、バックグラウンドでの処理はユーザに見せないよう高い秘匿性が担保されていた。
従来のサーバ・クライアント方式のシステムアーキテクチャとは打って変わって出た新しい形のアプリケーションであったが、高い匿名性も起因して、
一部のユーザが違法な音楽ファイルや動画ファイル、コンピュータウイルスをWinnyにアップロードしたことで著作権法違反が問われた。
開発者である金子氏にも疑いがかけられ2004年に逮捕、その後画期的な発明であったWinnyも衰退していった。

\subsection{Gnutella}
Winnyに同じくGnutellaも中央集権型サーバに依存せず、P2Pネットワーク上のノード間の通信のみでファイルを送受信を行うファイル共有アプリケーションである。

\subsection{Bitcoin}
Bitcoinは2008年にSatoshi Nakamotoと名乗る人物によって論文にて提唱されたものである。
2009年にはソフトウェアとして実現されており、今では多くのユーザに使用されている上、仮想通貨の先駆けとして他の仮想通貨を生む大きな起点となった。
同時に、2000年代後半に勢いを失っていたP2Pシステムの存在を再度世に知らしめ、開発の促進を促す起爆剤の役割を果たしたと考えられる。
Bitcoinは基盤技術のひとつとしてWinnyやGnutellaと共通するP2Pネットワークを採用している。
参加するノードはそれぞれがシステム上のデータを保持し相互にデータを検証しあうことで、第三者的監視機関を必要とせずにデータの堅の牢性を担保することが可能である。

\section{地理的分散システムの技術}
\label{background:geographically-disdtributed-system-technology}
本節では，地理的分散システムを実現するための技術について概説する．

\subsection{P2P}
P2Pとは"Peer to Peer"の略であり、ピアはコンピュータのことを指す。P2Pではコンピュータ同士が対等な関係を築いており、
従来のサーバ・クライアント方式で中央集権的な役割を担うサーバを必要とせずに成り立っている主従関係のないシステムモデルである。
サーバ・クライアント方式では、クライアントがリクエストを投げサーバがレスポンスを返すという明確な役割分担がなされている。
そのためサーバはクライアントからのリクエストが来るまで何もせず、リクエストが来たときのみ必要な処理を行ってクライアントへ返答する。
逆にクライアントはサーバに問い合わせる必要がないときは何もせず、データを要求したり変更する必要が生じたときのみクライアントとの通信を行う。
よって通信は常にクライアントが起点となり、基本的にサーバ起点の通信は行われない。
対象的に、P2Pではそれぞれのサーバが対等な関係で成り立っており、サーバ・クライアント方式のような明確な役割分担はシステム上されない。
何故ならP2Pでは各ピアが状況に応じてサーバとクライアントの役割を担うからである。固定的な役割がない代わりに、臨機応変にピアがサーバとしてレスポンスしたり、
クライアントとしてリクエストを投げたりと臨機応変な動的システムが特徴としてあげられる。
サーバ・クライアント方式では、リクエストを発信する側をクライアント、それに対してレスポンスを返す側をサーバと呼んでいるが、
P2Pでは前述した通り各ピアは動的に役割を変化させサーバとしてもクライアントとしても動くことからサーバントと呼ばれる。単にノードと呼ばれることもある。

\subsection{P2Pの特徴}
P2Pでは各ピアがサーバにもクライアントにも成り得るため、従来のサーバ・クライアント方式とは内部の実装も異なる。
まず第一に、データを保持する中央集権的なサーバが存在しないためアプリケーション上で必要になるデータは各ピアが保持することになる。
アプリケーションの実装方式によっても異なるが、各ピアがデータを分割して保持する場合もあれば全てのピアが同じデータを保持する場合もある。
ブロックチェーンではノードが全てのデータを保持しており（全てのデータを持たないタイプのノードとして参加することも可能）、データを相互で検証し合うことによって
データの改竄耐性を向上させ、堅牢性を担保している。逆にファイル共有システムであるWinnyでは、各ピアが保持しているデータは異なルため、データを参照する際は
どのピアが目的のデータを保持しているか検索し対象となるサーバを決定してから通信を行うなどの処理が必要となる。
次に、システムを動かすプログラムを各ピアが保持し動作させていなければいけない点でも従来とは異なる。
従来ではクライアントからのリクエストを受けつけたサーバが状況に応じて必要なプログラムを走らせればよかったため、サーバのみがアプリケーションプログラムの用意を求められた。
しかし、ノードが状況に応じてクライアントにもサーバにもなり得るP2Pではプログラムを各々で保持する必要性がある。
クライアントとして他のノードが保持しているデータを参照したり、データを要求してきたノードに対してレスポンスをしなければならない。

\subsection{P2Pのメリット}
本節では、P2Pのメリットについて概説する。
P2Pシステムの利点としては、拡張性（スケーラビリティ）・耐障害性があげられる。
まず第一に拡張性に関しては、従来のサーバ・クライアント方式の場合利用者が増大するとシステムの中心であるサーバへアクセスが集中し、
サーバやその周辺のネットワークにかかる負荷が高くなり、システム的な弱点になる。システム運用者は拡張性を高めるため、サーネットワーク機器の元々のスペックをあげたり、
負荷が増大した際に自動でサーバの数を増やすオートスケーリングなどの対策を取ることで対応する。
それに対してP2Pの場合、ノード同士は相互に通信を行うためアクセスは分散され、一点に集中することは考えにくい。その点でP2Pは拡張性に長けている。
次に耐障害性である。従来の場合、何らかの原因でサーバが落ちるとサービス自体が停止してしまいサーバが構造上の単一障害点となる。
しかしP2Pではどこかのノードが停止したとしても、正常なノード同士で新たなネットワークを形成することで問題なくサービスを継続することができるため、
構造上の単一障害点を取り除き障害性に長けている。

\subsection{P2Pのデメリット}
本節では、P2Pのデメリットについて概説する。
第一に情報伝達における遅延があげられる。P2Pでは接続先のコンピュータが固定ではないため、状況に応じて接続先を変更する必要がある。
すなわち、目的のデータを保持しているノードを探し出したり、そもそもネットワーク上で論理的に近い距離に他ノードが存在しない場合、
情報の取得や送信に遅延が生じてしまう。全てのノードで同じデータを保持するブロックチェーンのようなシステムにおいては、ノード同士がバケツリレーのようにデータを受け渡さなければならず、
端から端までデータを伝えるまでに時間が掛かってしまう。環境に左右されるが、サーバ・クライアント方式に比べて即時性が安定していないと考えられる。
次にシステム全体での管理のしにくさである。P2Pシステムでは各ノードでアプリケーションを動かすため、中央集権的なサーバと異なり、管理は各々のノード保持者に委ねられることになる。
つまり、たとえシステムに問題点が見つかりアプリケーション開発者がパッチを含んだアップデートバージョンを配布した場合でも、実際に動かしているアプリケーションがアップデートされるかどうかは保証されない。
同様にシステム全体の監視を行うことも困難である。

\section{地理的分散システムとステージング環境での動作確認}
\label{background:staging-environment}
本節では、地理的分散システムのステージング環境と動作確認について概説する。

\subsection{最小限の動作確認}
最も簡単に行える動作確認は、ふたつのノード間で行うテストである。ネットワーク上の二点でそれぞれノードを立ち上げ、システムの機能が正しく動作するかを確認する。
従来のサーバ・クライアント方式では、最低限ではあるが機能の保証ができる。サーバ・クライアント方式では、中央集権的サーバとクライアントが一対一の関係で繋がっており、開発者はクライアントとの通信ただひとつに注力すればいいからだ。
ユーザが増加した場合の障害対策やレスポンスタイムの向上は確かに必要であるが、サーバとクライアントの一対一の関係性は不変であるため、ネットワーク自体が正常で有る限り問題は二点間に閉ざされておりテストがしやすい。
一方、中央集権的サーバがなくノード同士がサーバにもクライアントにもなり得る地理的分散システムでは、この方法は十分ではない。ネットワークに参加するノードが増加すれば個々のノード同士の関係性は変化し、関係性が固定されないためである。
もうひとつの理由として、ノード周辺のネットワーク環境によって動作に影響が出る可能性が考えられる。地理的分散システムの具体例として挙げたBitcoinでは、参加するノードは全て同じデータを保持する。
データの送信や受信において遅延が発生すれば何らかの影響が出ることは簡単に予想可能である。例えシステム上でデータの不整合を防ぐロジックが組まれていたとしても、ロジックを表現したコードが実際の環境で正常な動作をすることを動作確認無しで担保することは難しい。
以上の理由から、地理的分散システムの動作確認をするにあたって二点間でのステージング環境は不十分であり、より多くのノードを実際の世界規模のネットワーク上で動かしたステージング環境が必要であると考えられる。

\subsection{地理的に分散したノードによる動作確認}
上記で述べた通り、地理的分散システムのステージング環境は世界規模のネットワーク上で構築する必要性がある。
しかしこの方法は、ステージング環境の構築ならびに動作確認の進行において多大なるコミュニケーションコストとヒューマンリソースが予想される。
まず環境構築において離れた地点にノードを設置する必要性がある。地点ごとにノードを設置する人に加え、ノードのスペックやネットワークの構成等について共有するためのコミュニケーションが必要となる。
必要な物理筐体が揃ったのち、地理的分散システム上で走らせるアプリケーションを各ポイントに配布し、各開発者は受け取ったアプリケーションファイルを設置したノードの上で走らせる必要がある。
ステージング環境でシステムを走らせた後に関しては、機能面や性能面での動作確認を行い、修正箇所があれば開発者がパッチを適応した後、修正後のアプリケーションファイルを各ポイントに配布するところから再度やり直さなければならない。
修正箇所が増加するに比例して、コミュニケーションコストと必要なヒューマンリソースは膨れ上がることが予想される。
さらにコミュニケーションの不足や伝達ミス等の人的ミスにより理想的な動作確認が行えないケースも考えられる。
以上の点から、地理的分散システムのステージング環境においてコミュニケーションベースの動作確認には多くの課題があり現実的に困難である。
それ故、地理的に分散したノードを任意のポイントから統合的に管理することによって各地点での作業や地点間でのコミュニケーションを削減する必要性があると考えられる。

\subsection{独自実装のデバッグエージェントによる動作確認}
既存の提案として、地理的に分散したノードを統合管理・操作するために別アプリケーションを独自で開発する手法がある。
別アプリケーションとは、対象アプリケーションに対して命令を送信したり通信内容をログとして抽出するなどのデバッグエージェントして動作する。
ノードを統合管理出来る点では要件を満たしており、コミュニケーションならびに工数の削減に繋がると考えられる。
しかし対象アプリケーションにパッチを適用したい場合、同様にそれを操作するデバッグエージェントにも変更を加える必要があり、変更への弱さが窺える。
アップデートへの柔軟性が不足している限り、それによって生じるオーバーヘッドを削減することが出来ず根本的な解決に繋がらないと思われる。
分散したノードを一斉にコントロールだけでなく、アプリケーションの停止や更新といった変更においてもより少ない手間で抑えられることが求められ、
それを満たした際に地理的分散システムの十分なステージング環境が成り立つと考えられる。

\section{Kubernetes}
\label{background:kubernetes}

\section{OpenVPN}
\label{background:openvpn}

\if0
\begin{figure}[h]
    \begin{center}
        \includegraphics[scale=0.4]{./img/hashrate.png}
        \caption{2017年1月のハッシュレート分布 出典：Blockchain.info\cite{bitcoinhashrate}}
        \label{img:hashrate}
    \end{center}
\end{figure}
\fi
